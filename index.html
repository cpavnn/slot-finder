<html>
    <head>
<style>
    table{
        width: 95%;
        padding:20px;
        border-spacing:16px;
    }
    td, th{
        text-align: left;
    }
  

</style>
</head>
<body>
<h2>
    Free slot finder - Bangalore for ages < 45
</h2>
<div id="write-here">


</div>
<a href="https://github.com/cpavnn/slot-finder" target="_blank" rel="noopener" class="visible-lg">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="icons/github.png" alt="github" />
</a>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="/__/firebase/8.4.3/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="/__/firebase/8.4.3/firebase-analytics.js"></script>

<!-- Initialize Firebase -->
<script src="/__/firebase/init.js"></script>

<script>

    function loaddata(){
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();
        
        today = dd + '-' + mm + '-' + yyyy;
        
        let url  = 'https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByDistrict?district_id=294&date=';
        url+= today;
        var listofslots = '';
        fetch(url).then(
            response => response.json())
            .then(response => {
        
                
                for(const prop in response.centers){
                    var center = response.centers[prop];
                    var sessions = center["sessions"];
                     for(const session in sessions) {
                       var currentSession = sessions[session];
                      
                       if(currentSession.min_age_limit <= 45 && currentSession.available_capacity >0) {
                        
                        listofslots+= '<tr><td>';
                        listofslots+= center.name;
                        listofslots+= '</td><td>';
                        listofslots+= center.pincode;
                        listofslots+= '</td><td>';
                        listofslots+=  currentSession.vaccine;
                        listofslots+= '</td><td>';
                        listofslots+=  currentSession.available_capacity;
                        listofslots+= '</td><td>';
                        listofslots+=  currentSession.slots.toString();
                        listofslots+= '</td></tr>';                        
                        
                       }                         
                        
                     }                       
                    
                }
               
                if(listofslots.length == 0){
                    listofslots = '<h1>No slots found in Bangalore for <45 years</h1>'
                } 

                document.getElementById("write-here").innerHTML = '<table><thead><tr><th>Center</th><th>Pincode</th><th>Vaccine</th><th>Available capacity </th><th>Slots</th></tr></thead><tbody>' + listofslots  +'</tbody></p>';
             
            });
        


    }


    window.onload = function () {
        loaddata();
    }
</script>
</body>
</html>